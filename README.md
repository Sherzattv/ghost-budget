# ğŸ’° Ghost Budget â€” Personal Finance Telegram Bot

## ğŸ“‹ Overview

**Ghost Budget** â€” ÑÑ‚Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒÑ‡ĞµÑ‚Ğ° Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ², Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ°Ñ Ñ‡ĞµÑ€ĞµĞ· Telegram Ğ±Ğ¾Ñ‚Ğ°. 
ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñƒ **Stateless Event-Driven** Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ inline-ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº.

### Ğ¡Ñ‚ĞµĞº Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹
```
Telegram Bot (Python + aiogram 3.x)
       â†“
  Railway (Hosting + Auto-deploy)
       â†“
  Supabase (PostgreSQL Database)
       â†“
  [Future] Web Dashboard (Next.js)
```

---

## ğŸ§  ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

### Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ: Â«Ğ”ĞµĞ½ÑŒĞ³Ğ¸ Ğ½Ğµ Ğ¸ÑÑ‡ĞµĞ·Ğ°ÑÑ‚, Ğ¾Ğ½Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°ÑÑ‚ÑÑÂ»

Ğ’ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ Ğ´Ğ²ÑƒĞ¼Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Â«ĞŸÑ€Ğ¸Ñ…Ğ¾Ğ´/Ğ Ğ°ÑÑ…Ğ¾Ğ´Â», Ğ¼Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ **Double Entry Bookkeeping** (Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ) Ğ² ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ:

- **Ğ Ğ°ÑÑ…Ğ¾Ğ´** = Ğ”ĞµĞ½ÑŒĞ³Ğ¸ ÑƒÑ…Ğ¾Ğ´ÑÑ‚ Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ° (Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ° ĞµĞ´Ñ‹)
- **Ğ”Ğ¾Ñ…Ğ¾Ğ´** = Ğ”ĞµĞ½ÑŒĞ³Ğ¸ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´ÑÑ‚ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ¸Ğ·Ğ²Ğ½Ğµ (Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°)
- **ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´** = ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ´ĞµĞ½ĞµĞ³ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑÑ‡ĞµÑ‚Ğ°Ğ¼Ğ¸ (Ğ½Ğ° Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚, Ğ´Ñ€ÑƒĞ³Ñƒ)

> ğŸ’¡ **ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ñ…Ğ°Ğº**: Ğ”Ğ¾Ğ»Ğ³ â€” ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¶Ğµ Ğ¡Ñ‡ĞµÑ‚. ĞšĞ¾Ğ³Ğ´Ğ° Ñ‚Ñ‹ Ğ´Ğ°Ñ‘ÑˆÑŒ Ğ² Ğ´Ğ¾Ğ»Ğ³, Ñ‚Ğ²Ğ¾Ğ¹ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ» Ğ½Ğµ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ°ĞµÑ‚ÑÑ â€” Ğ´ĞµĞ½ÑŒĞ³Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°ÑÑ‚ÑÑ Ğ¸Ğ· "Kaspi" Ğ² "ĞĞ¹Ğ±ĞµĞº".

---

## ğŸ¤– UX Telegram Ğ‘Ğ¾Ñ‚Ğ°

### Stateless Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (ĞœĞ°Ñ‚Ñ€ĞµÑˆĞºĞ°)
Ğ‘Ğ¾Ñ‚ **Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°** Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¸Ğ»Ğ¸ Ğ‘Ğ”. Ğ’ÑÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `callback_data` ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº ĞºĞ°Ğº JSON.

### User Flow

```
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ§Ğ˜Ğ¡Ğ›Ğ (ÑÑƒĞ¼Ğ¼Ñƒ): 2000
                    â†“
2. Ğ‘Ğ¾Ñ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ‚Ğ¸Ğ¿Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸:
   [ğŸ“‰ Ğ Ğ°ÑÑ…Ğ¾Ğ´] [ğŸ“ˆ Ğ”Ğ¾Ñ…Ğ¾Ğ´]
   [ğŸ”„ ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´] [ğŸ¤ Ğ”Ğ¾Ğ»Ğ³Ğ¸]
   [âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°]
                    â†“
3. ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ‚Ğ¸Ğ¿Ğ° â†’ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸/ÑÑ‡ĞµÑ‚Ğ°
                    â†“  
4. ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ â†’ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‡Ñ‘Ñ‚Ğ°-Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°
                    â†“
5. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Supabase â†’ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
```

---

## ğŸ—ï¸ Project Structure

```
wallet/
â”œâ”€â”€ README.md                 # This file
â”œâ”€â”€ DATABASE.md               # Database schema docs
â”œâ”€â”€ requirements.txt          # Python dependencies
â”œâ”€â”€ runtime.txt              # Python version for Railway
â”œâ”€â”€ Procfile                 # Railway start command
â”œâ”€â”€ .env.example             # Environment variables template
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # Entry point
â”‚   â”œâ”€â”€ config.py            # Configuration & env vars
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ start.py         # /start, /help commands
â”‚   â”‚   â”œâ”€â”€ transaction.py   # Number input handler
â”‚   â”‚   â”œâ”€â”€ callbacks.py     # Inline button callbacks
â”‚   â”‚   â”œâ”€â”€ balance.py       # /balance command
â”‚   â”‚   â””â”€â”€ settings.py      # Account/category management
â”‚   â”‚
â”‚   â”œâ”€â”€ keyboards/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ inline.py        # Inline keyboard builders
â”‚   â”‚   â””â”€â”€ reply.py         # Reply keyboard builders
â”‚   â”‚
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ supabase.py      # Supabase client
â”‚   â”‚   â”œâ”€â”€ models.py        # Pydantic models
â”‚   â”‚   â””â”€â”€ queries.py       # Database queries
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ callback_data.py # Callback data serialization
â”‚   â”‚   â””â”€â”€ formatters.py    # Message formatters
â”‚   â”‚
â”‚   â””â”€â”€ middlewares/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ auth.py          # User auth middleware
â”‚
â””â”€â”€ docs/
    â””â”€â”€ Ğ¼Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³           # Original planning dialogs
```

---

## ğŸš€ Quick Start

### Local Development

```bash
# Clone repo
git clone https://github.com/your/wallet.git
cd wallet

# Create virtual environment
python -m venv venv
source venv/bin/activate  # Linux/Mac
# or: venv\Scripts\activate  # Windows

# Install dependencies
pip install -r requirements.txt

# Copy env file and fill in values
cp .env.example .env

# Run bot
python -m bot.main
```

### Deploy to Railway

1. Push to `main` branch
2. Railway auto-deploys (connected via GitHub)

---

## ğŸ” Environment Variables

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=your_anon_key

# Optional
DEBUG=false
LOG_LEVEL=INFO
```

---

## ğŸ“± Bot Commands

| ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---------|----------|
| `/start` | ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹, Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ |
| `/help` | Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼ |
| `/balance` | ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ°Ğ½ÑÑ‹ Ğ²ÑĞµÑ… ÑÑ‡ĞµÑ‚Ğ¾Ğ² |
| `/stats` | ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ·Ğ° Ğ¼ĞµÑÑÑ† |
| `/accounts` | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‡ĞµÑ‚Ğ°Ğ¼Ğ¸ |
| `/categories` | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸ |
| `<Ñ‡Ğ¸ÑĞ»Ğ¾>` | ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²Ğ²Ğ¾Ğ´ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸ |

---

## ğŸ”„ Callback Data Format

Telegram Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ `callback_data` Ğ´Ğ¾ **64 Ğ±Ğ°Ğ¹Ñ‚**. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑĞ¾ĞºÑ€Ğ°Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸:

```python
{
    "a": 2000,        # amount
    "t": "exp",       # type: exp|inc|trf|debt
    "c": "uuid",      # category_id
    "s": "uuid",      # source account
    "d": "uuid",      # destination account
    "m": 12345        # message_id to delete
}
```

---

## ğŸš€ Roadmap

### Phase 1: MVP Bot âœ… (Current)
- [x] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Supabase
- [ ] Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Python Ğ±Ğ¾Ñ‚Ğ°
- [ ] Ğ’Ğ²Ğ¾Ğ´ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ² Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸
- [ ] Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‡Ñ‘Ñ‚Ğ°

### Phase 2: Full Bot
- [ ] Ğ”Ğ¾Ñ…Ğ¾Ğ´Ñ‹
- [ ] ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑÑ‡ĞµÑ‚Ğ°Ğ¼Ğ¸
- [ ] Ğ”Ğ¾Ğ»Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- [ ] ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¾Ğ² `/balance`

### Phase 3: Analytics
- [ ] ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ `/stats`
- [ ] AI ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- [ ] Ğ‘ÑĞ´Ğ¶ĞµÑ‚Ñ‹ Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹

### Phase 4: Web Dashboard
- [ ] Next.js Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ

---

## ï¿½ Database

Ğ¡Ğ¼. [DATABASE.md](./DATABASE.md) Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ÑÑ…ĞµĞ¼Ñ‹.

**Supabase Project**: `cnakcohphvblybhzrobz`

---

*Last updated: 2026-01-26*

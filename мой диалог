
–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (Context Prompt), –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—à—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –¢—ã –º–æ–∂–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –∏–ª–∏ —Å–∫–æ—Ä–º–∏—Ç—å –¥—Ä—É–≥–æ–º—É AI, —á—Ç–æ–±—ã –æ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–Ω—è–ª, –Ω–∞–¥ —á–µ–º –º—ã —Ä–∞–±–æ—Ç–∞–µ–º, –Ω–µ –∑–∞–¥–∞–≤–∞—è –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
üìã –ü—Ä–æ–º–ø—Ç: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ë–æ—Ç–∞ (n8n + GSheets)
–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É—á–µ—Ç–∞ –ª–∏—á–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –°—Ç–µ–∫: Telegram Bot (Frontend) ‚Üí n8n (Backend/Logic) ‚Üí Google Sheets (Database).
1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (Google Sheets): –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø –î–≤–æ–π–Ω–æ–π –∑–∞–ø–∏—Å–∏ (Double Entry), –Ω–æ –≤ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ.
–¢–∞–±–ª–∏—Ü–∞: DB_Transactions.
–õ–æ–≥–∏–∫–∞: –õ—é–±–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤.
–ö–æ–ª–æ–Ω–∫–∏: Date, Type, Src (–û—Ç–∫—É–¥–∞), Dst (–ö—É–¥–∞), Amount, Category.
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (Ref): –°—á–µ—Ç–∞ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã (–ö–æ—à–µ–ª—å–∫–∏, –î–æ–ª–∂–Ω–∏–∫–∏, –ö—Ä–µ–¥–∏—Ç–æ—Ä—ã). –î–æ–ª–≥–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ —Å—á–µ—Ç–∞ (Accounts).
2. –õ–æ–≥–∏–∫–∞ Telegram –ë–æ—Ç–∞ (UX):
Stateless –ø–æ–¥—Ö–æ–¥: –ë–æ—Ç –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –≤ –ë–î. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è ¬´–º–∞—Ç—Ä–µ—à–∫–æ–π¬ª –≤–Ω—É—Ç—Ä–∏ callback_data –∫–Ω–æ–ø–æ–∫.
–í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ß–ò–°–õ–û (—Å—É–º–º—É).
3. –¢–µ–∫—É—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Workflow –≤ n8n): –†–µ–∞–ª–∏–∑—É–µ–º –≤–µ—Ç–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ —á–∏—Å–ª–∞.
Trigger: Telegram (On Message).
Filter: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥—É–ª—è—Ä–∫–æ–π ^\d+$ (—ç—Ç–æ —á–∏—Å–ª–æ?).
Code Node: –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON –º–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¢–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–†–∞—Å—Ö–æ–¥, –î–æ—Ö–æ–¥, –ü–µ—Ä–µ–≤–æ–¥, –î–æ–ª–≥).
Payload –∫–Ω–æ–ø–∫–∏: {"a": 2000, "t": "exp"} (–°—É–º–º–∞ + –¢–∏–ø).
Action: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏.
–ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –Ω–æ–¥–∞ Telegram –≤ n8n –ø–ª–æ—Ö–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã –∫–Ω–æ–ø–æ–∫ —á–µ—Ä–µ–∑ Expressions.
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–¥—É HTTP Request, –æ—Ç–ø—Ä–∞–≤–ª—è—è —Å—ã—Ä–æ–π POST –∑–∞–ø—Ä–æ—Å –Ω–∞ sendMessage —Å —Ä—É—á–Ω—ã–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º JSON body.
4. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:
–°—É–º–º–∞: Integer.
Callback Data: –°—Ç—Ä–æ–≥–∏–π JSON. –ö–ª—é—á–∏ —Å–æ–∫—Ä–∞—â–µ–Ω—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±–∞–π—Ç–æ–≤ (a=amount, t=type, c=category, src/dst=source/destination).


–∫–æ—Ä–æ—á–µ —è –∑–∞—Å—Ç—Ä—è–ª –º–Ω–µ –Ω–∞–¥–æ –æ—Ç–ø—Ä–≤–∏—Ç—å http —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏
–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP Request –Ω–æ–¥—É
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å 4 inline –∫–Ω–æ–ø–∫–∞–º–∏ —á–µ—Ä–µ–∑ HTTP Request –≤ n8n –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP Request –Ω–æ–¥—ã
Method: POST
URL: https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage

Body Content Type: JSON

Body (JSON):

json
{
  "chat_id": "{{ $json.message.chat.id }}",
  "text": "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:",
  "reply_markup": {
    "inline_keyboard": [
      [
        {"text": "üí∏ –†–∞—Å—Ö–æ–¥", "callback_data": "{\"a\":{{ $json.message.text }},\"t\":\"exp\"}"}
      ],
      [
        {"text": "üí∞ –î–æ—Ö–æ–¥", "callback_data": "{\"a\":{{ $json.message.text }},\"t\":\"inc\"}"}
      ],
      [
        {"text": "üîÑ –ü–µ—Ä–µ–≤–æ–¥", "callback_data": "{\"a\":{{ $json.message.text }},\"t\":\"trans\"}"}
      ],
      [
        {"text": "ü§ù –î–æ–ª–≥", "callback_data": "{\"a\":{{ $json.message.text }},\"t\":\"debt\"}"}
      ]
    ]
  }
}
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —á–µ—Ä–µ–∑ Code Node + HTTP Request
–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª—å—à–∞—è –≥–∏–±–∫–æ—Å—Ç—å, –º–æ–∂–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å payload –≤ Code Node:

Code Node:

javascript
const amount = $input.first().json.message.text;
const chatId = $input.first().json.message.chat.id;

const keyboard = [
  [{"text": "üí∏ –†–∞—Å—Ö–æ–¥", "callback_data": JSON.stringify({"a": parseInt(amount), "t": "exp"})}],
  [{"text": "üí∞ –î–æ—Ö–æ–¥", "callback_data": JSON.stringify({"a": parseInt(amount), "t": "inc"})}],
  [{"text": "üîÑ –ü–µ—Ä–µ–≤–æ–¥", "callback_data": JSON.stringify({"a": parseInt(amount), "t": "trans"})}],
  [{"text": "ü§ù –î–æ–ª–≥", "callback_data": JSON.stringify({"a": parseInt(amount), "t": "debt"})}]
];

return [{
  json: {
    chat_id: chatId,
    text: `–°—É–º–º–∞: ${amount} ‚Ç∏\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:`,
    reply_markup: JSON.stringify({"inline_keyboard": keyboard})
  }
}];
HTTP Request –ø–æ—Å–ª–µ Code Node:

URL: https://api.telegram.org/bot<TOKEN>/sendMessage

Method: POST

Body: {{ $json }}

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã
reply_markup –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–∏–±–æ –æ–±—ä–µ–∫—Ç–æ–º (–≤ —á–∏—Å—Ç–æ–º JSON), –ª–∏–±–æ —Å—Ç—Ä–æ–∫–æ–π (–µ—Å–ª–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å —á–µ—Ä–µ–∑ –∫–æ–¥)

callback_data –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 64 –±–∞–π—Ç–∞ ‚Äî —Ç–≤–æ—è —Å—Ö–µ–º–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –∏–¥–µ–∞–ª—å–Ω–∞

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ inline_keyboard ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
‚Äã

chat_id –±–µ—Ä–µ—Ç—Å—è –∏–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: $json.message.chat.id

–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–æ–±–æ–≤–∞–ª? –ü–æ–∫–∞–∂–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ JSON –∏–∑ HTTP Request –Ω–æ–¥—ã, –µ—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Sonnet 4.5 –ú—ã—Å–ª–∏—Ç—å
—É –º–µ–Ω—è –≤–æ—Ç —Ç–∞–∫–æ–π –ø—Ä–µ–∂–¥–µ –∫–æ–¥ : // 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—á–∏—Å–ª–æ) –∏–∑ —Å–∞–º–æ–π –ø–µ—Ä–≤–æ–π –Ω–æ–¥—ã
// –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏–º—è –Ω–æ–¥—ã –≤ —Å–∫–æ–±–∫–∞—Ö —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–≤–æ–∏–º —Ç—Ä–∏–≥–≥–µ—Ä–æ–º
const messageText = $('Telegram Trigger').item.json.message.text;
const amount = parseInt(messageText);

// 2. –†–∏—Å—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—Ä—É—á–Ω—É—é
// –í –∫–∞–∂–¥—É—é –∫–Ω–æ–ø–∫—É –º—ã –∫–ª–∞–¥–µ–º "a" (amount) –∏ "t" (type)
const keyboard = [
// –†—è–¥ 1
[
{ text: 'üìâ –†–∞—Å—Ö–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'exp' }) },
{ text: 'üìà –î–æ—Ö–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'inc' }) }
],
// –†—è–¥ 2
[
{ text: 'üîÑ –ü–µ—Ä–µ–≤–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'trf' }) },
{ text: 'ü§ù –î–æ–ª–≥–∏', callback_data: JSON.stringify({ a: amount, t: 'debt' }) }
],
// –†—è–¥ 3
[
{ text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: 'cancel' }
]
];

return {
json: {
text_msg: `–°—É–º–º–∞: ${amount} ‚Ç∏. –ß—Ç–æ —ç—Ç–æ –±—ã–ª–æ?`,
reply_markup: { inline_keyboard: keyboard }
}
};
–û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ chat_id –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP Request –Ω–æ–¥—É –ø–æ—Å–ª–µ –Ω–µ–≥–æ.
‚Äã

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Code Node
javascript
// 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞
const messageText = $('Telegram Trigger').item.json.message.text;
const chatId = $('Telegram Trigger').item.json.message.chat.id;
const amount = parseInt(messageText);

// 2. –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
const keyboard = [
  [
    { text: 'üìâ –†–∞—Å—Ö–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'exp' }) },
    { text: 'üìà –î–æ—Ö–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'inc' }) }
  ],
  [
    { text: 'üîÑ –ü–µ—Ä–µ–≤–æ–¥', callback_data: JSON.stringify({ a: amount, t: 'trf' }) },
    { text: 'ü§ù –î–æ–ª–≥–∏', callback_data: JSON.stringify({ a: amount, t: 'debt' }) }
  ],
  [
    { text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: 'cancel' }
  ]
];

// 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ç–æ–≤—ã–π payload –¥–ª—è Telegram API
return {
  json: {
    chat_id: chatId,
    text: `–°—É–º–º–∞: ${amount} ‚Ç∏. –ß—Ç–æ —ç—Ç–æ –±—ã–ª–æ?`,
    reply_markup: JSON.stringify({ inline_keyboard: keyboard })
  }
};
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP Request –Ω–æ–¥—ã (–ø–æ—Å–ª–µ Code Node)
Method: POST

URL:

text
https://api.telegram.org/bot{{ $('Telegram Trigger').item.json.botToken }}/sendMessage
–ò–ª–∏ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ:

text
https://api.telegram.org/botYOUR_BOT_TOKEN_HERE/sendMessage
Authentication: None (—Ç–æ–∫–µ–Ω —É–∂–µ –≤ URL)

Send Body: On

Body Content Type: JSON

Specify Body: Using JSON

JSON Body:

text
{{ $json }}
Options:

Response Format: JSON

–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–≤–æ–µ–º –∫–æ–¥–µ
–î–æ–±–∞–≤–ª–µ–Ω chat_id ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è Telegram API
‚Äã

reply_markup –æ–±–µ—Ä–Ω—É—Ç –≤ JSON.stringify() ‚Äî API Telegram –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç
‚Äã

–£–±—Ä–∞–Ω–æ text_msg, –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ text ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ API

–ü—Ä–æ–≤–µ—Ä–∫–∞
–¢–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π payload –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫ (–≤ HTTP Request):

json
{
  "chat_id": 123456789,
  "text": "–°—É–º–º–∞: 2000 ‚Ç∏. –ß—Ç–æ —ç—Ç–æ –±—ã–ª–æ?",
  "reply_markup": "{\"inline_keyboard\":[[{\"text\":\"üìâ –†–∞—Å—Ö–æ–¥\",\"callback_data\":\"{\\\"a\\\":2000,\\\"t\\\":\\\"exp\\\"}\"},{\"text\":\"üìà –î–æ—Ö–æ–¥\",\"callback_data\":\"{\\\"a\\\":2000,\\\"t\\\":\\\"inc\\\"}\"}],[{\"text\":\"üîÑ –ü–µ—Ä–µ–≤–æ–¥\",\"callback_data\":\"{\\\"a\\\":2000,\\\"t\\\":\\\"trf\\\"}\"},{\"text\":\"ü§ù –î–æ–ª–≥–∏\",\"callback_data\":\"{\\\"a\\\":2000,\\\"t\\\":\\\"debt\\\"}\"}],[{\"text\":\"‚ùå –û—Ç–º–µ–Ω–∞\",\"callback_data\":\"cancel\"}]]}"
}
–ü–æ–ø—Ä–æ–±—É–π ‚Äî –¥–æ–ª–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å! –ï—Å–ª–∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É, —Å–∫–∏–Ω—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ n8n.

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Sonnet 4.5 –ú—ã—Å–ª–∏—Ç—å
–∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ)
–û—Ç–ª–∏—á–Ω–æ! üéâ

–¢–µ–ø–µ—Ä—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback –æ—Ç –∫–Ω–æ–ø–æ–∫. –¢–µ–±–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:

–ù–æ–≤—ã–π Telegram Trigger —Å —Ç–∏–ø–æ–º "On Callback Query" (–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –≤ workflow)

Parse callback_data —á–µ—Ä–µ–∑ JSON.parse() —á—Ç–æ–±—ã –∏–∑–≤–ª–µ—á—å a –∏ t

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ UI ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–¥–ª—è –†–∞—Å—Ö–æ–¥–∞) –∏–ª–∏ —Å—á–µ—Ç–∞–º–∏ (–¥–ª—è –ü–µ—Ä–µ–≤–æ–¥–∞)

–•–æ—á–µ—à—å —Å—Ä–∞–∑—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å –ª–æ–≥–∏–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∏–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—à—å —Ç–µ–∫—É—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π? üòä

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Sonnet 4.5 –ú—ã—Å–ª–∏—Ç—å
–ø–æ—Å–ª–µ switch –¥–∞–≤–∞–π –ø—Ä–µ–¥–ª–æ–∂–∏–ª –µ–º—É –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞ —á—Ç–æ —É—à–ª–æ –∏ 3 —à—Ç –∫–æ–¥–æ–º (–µ–¥–∞, –ø—Ä–æ–¥—É–∫—Ç—ã, —Ç–∞–∫—Å–∏, –±–ª–∞–≥–æ—Å–ª–æ–≤–Ω–∏–µ) –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–∏–º —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –ò–ò –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–∞–ø–∏—à–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é
–û—Ç–ª–∏—á–Ω–æ! –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

Switch Node (–¥–æ–±–∞–≤—å Output 3):
text
Output 0: {{ $json.route === "cancel" }}
Output 1: {{ $json.route === "finalize" }}
Output 2: {{ $json.route === "exp_choose_source" }}
Output 3: {{ $json.route === "exp_choose_category" }}
Output 3: Code Node –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
javascript
const ctx = $input.first().json;

// –¢–æ–ø-3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
const categories = [
  { id: 'food', name: '–ï–¥–∞', icon: 'üçî' },
  { id: 'products', name: '–ü—Ä–æ–¥—É–∫—Ç—ã', icon: 'üõí' },
  { id: 'taxi', name: '–¢–∞–∫—Å–∏', icon: 'üöï' },
  { id: 'blessing', name: '–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ', icon: 'ü§≤' }
];

// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ (–ø–æ 2 –≤ —Ä—è–¥)
const keyboard = [];

for (let i = 0; i < categories.length; i += 2) {
  const row = [];
  row.push({
    text: `${categories[i].icon} ${categories[i].name}`,
    callback_data: JSON.stringify({
      a: ctx.amount,
      t: 'exp',
      src: ctx.rawData.src,
      c: categories[i].id,
      umid: ctx.userMessageId
    })
  });
  
  if (categories[i + 1]) {
    row.push({
      text: `${categories[i + 1].icon} ${categories[i + 1].name}`,
      callback_data: JSON.stringify({
        a: ctx.amount,
        t: 'exp',
        src: ctx.rawData.src,
        c: categories[i + 1].id,
        umid: ctx.userMessageId
      })
    });
  }
  
  keyboard.push(row);
}

// –ö–Ω–æ–ø–∫–∞ "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"
keyboard.push([{
  text: '‚úçÔ∏è –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç',
  callback_data: JSON.stringify({
    a: ctx.amount,
    t: 'exp',
    src: ctx.rawData.src,
    action: 'custom_category',
    umid: ctx.userMessageId
  })
}]);

// –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥
keyboard.push([{
  text: '‚óÄÔ∏è –ù–∞–∑–∞–¥',
  callback_data: JSON.stringify({
    a: ctx.amount,
    t: 'exp',
    umid: ctx.userMessageId
  })
}]);

return {
  json: {
    chat_id: ctx.chatId,
    message_id: ctx.messageId,
    text: `üìâ –†–∞—Å—Ö–æ–¥ ${ctx.amount} ‚Ç∏\n–°—á–µ—Ç: ${ctx.rawData.src}\n\n–ù–∞ —á—Ç–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏?`,
    reply_markup: JSON.stringify({ inline_keyboard: keyboard })
  }
};
–î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç–∫—É "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç" –≤ Parse Callback
–í Parse Callback –¥–æ–±–∞–≤—å (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ action === 'cancel'):

javascript
// –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
if (data.action === 'custom_category') {
  return {
    json: {
      route: 'wait_custom_category',
      amount: amount,
      type: type,
      source: data.src,
      chatId: chatId,
      messageId: messageId,
      userMessageId: userMessageId,
      callbackQueryId: callbackQueryId
    }
  };
}
Switch –¥–æ–±–∞–≤—å Output 4:
text
Output 4: {{ $json.route === "wait_custom_category" }}
Output 4: –ü—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
Code Node:

javascript
const ctx = $input.first().json;

return {
  json: {
    chat_id: ctx.chatId,
    message_id: ctx.messageId,
    text: `üìâ –†–∞—Å—Ö–æ–¥ ${ctx.amount} ‚Ç∏\n\n‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞ —á—Ç–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–∫—É–ø–∏–ª —Ö–ª–µ–±" –∏–ª–∏ "–∑–∞–ø—Ä–∞–≤–∫–∞")`,
    reply_markup: JSON.stringify({
      inline_keyboard: [[{
        text: '‚ùå –û—Ç–º–µ–Ω–∞',
        callback_data: JSON.stringify({ action: 'cancel', umid: ctx.userMessageId })
      }]]
    })
  }
};
‚Üí HTTP editMessageText ‚Üí answerCallback

–î–∞–ª—å—à–µ –Ω—É–∂–Ω–æ –ª–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ò–ò. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —ç—Ç—É —á–∞—Å—Ç—å! –†–∞–±–æ—Ç–∞–µ—Ç? üéØ

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Sonnet 4.5 –ú—ã—Å–ª–∏—Ç—å
—Ç—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å. —è –≤—ã–±—Ä–∞–ª –∫–Ω–æ–ø–∫—É —Ä–∞—Å—Ö–æ–¥. —Ä–∞—Å–ø–∞—Ä—Å–µ—Ä —Å–≤–æ—é —Ä–∞–±–æ—Ç—É —Å–¥–µ–ª–∞–ª. –¥–∞–ª–µ–µ —Å–≤–∏—Ç—á —è —Å–¥–µ–ª–∞–ª –≤—ã—Ö–æ–¥ –Ω–∞ —Ä–∞—Å—Ö–æ–¥. –¥–∞–ª–µ–µ —á—Ç–æ?
–ê–∞–∞, —Ç–æ—á–Ω–æ! –î–∞–≤–∞–π –ø–æ —à–∞–≥–∞–º –ø–æ—Å–ª–µ Switch.

–ü–æ—Å–ª–µ Switch Output –¥–ª—è exp_choose_source:
Code Node: –í—ã–±–æ—Ä —Å—á–µ—Ç–∞
javascript
const ctx = $input.first().json;

// –°—á–µ—Ç–∞
const accounts = [
  { id: 'kaspi', name: 'Kaspi Gold', icon: 'üí≥' },
  { id: 'cash', name: '–ù–∞–ª–∏—á–Ω—ã–µ', icon: 'üíµ' },
  { id: 'halyk', name: 'Halyk', icon: 'üåê' }
];

// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
const keyboard = accounts.map(acc => [
  {
    text: `${acc.icon} ${acc.name}`,
    callback_data: JSON.stringify({
      a: ctx.amount,
      t: 'exp',
      src: acc.id,
      umid: ctx.userMessageId
    })
  }
]);

// –ù–∞–∑–∞–¥
keyboard.push([{
  text: '‚óÄÔ∏è –ù–∞–∑–∞–¥',
  callback_data: JSON.stringify({ a: ctx.amount, umid: ctx.userMessageId })
}]);

return {
  json: {
    chat_id: ctx.chatId,
    message_id: ctx.messageId,
    text: `üìâ –†–∞—Å—Ö–æ–¥ ${ctx.amount} ‚Ç∏\n\n–û—Ç–∫—É–¥–∞ —Å–ø–∏—Å–∞—Ç—å?`,
    reply_markup: JSON.stringify({ inline_keyboard: keyboard })
  }
};
HTTP Request: editMessageText
URL: https://api.telegram.org/bot<TOKEN>/editMessageText
Body: {{ $json }}

HTTP Request: answerCallbackQuery
URL: https://api.telegram.org/bot<TOKEN>/answerCallbackQuery
Body:

json
{
  "callback_query_id": "{{ $('Parse Callback').item.json.callbackQueryId }}"
}
–í–æ—Ç –∏ –≤—Å—ë –¥–ª—è —ç—Ç–æ–≥–æ –≤—ã—Ö–æ–¥–∞! –ù–∞–∂–∏–º–∞–µ—à—å –†–∞—Å—Ö–æ–¥ ‚Üí –≤–∏–¥–∏—à—å —Å—á–µ—Ç–∞. –î–∞–ª—å—à–µ? üöÄ

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Sonnet 4.5 –ú—ã—Å–ª–∏—Ç—å
—Å–ª—É—à–∞–π –Ω—É –≤—ã–±–æ—Ä —Å—á–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–∏–Ω–∏–º–∞—á–Ω—ã–º –∏–∑ –≥—É–≥–ª —Ç–∞–±–ª–∏—Ü
–¢–æ—á–Ω–æ! –î–∞–≤–∞–π –ø–æ–¥—Ç—è–Ω–µ–º –∏–∑ Google Sheets.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ Switch:
text
[Switch Output: exp_choose_source]
        ‚Üì
[Google Sheets: Read Rows]
        ‚Üì
[Code: –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö]
        ‚Üì
[HTTP: editMessageText]
        ‚Üì
[HTTP: answerCallbackQuery]
Google Sheets Node –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
Operation: Append or Update ‚Üí Read Rows
Document: –¢–≤–æ–π —Ñ–∞–π–ª —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
Sheet: Ref_Accounts
Return All: Yes

Code Node: –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –∏–∑ Sheets
javascript
const ctx = $('Parse Callback').item.json;
const sheetData = $input.all(); // –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ Sheets

// –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—á–µ—Ç–∞ –≥—Ä—É–ø–ø—ã 'asset'
const accounts = sheetData
  .map(item => item.json)
  .filter(row => row.Active === 'TRUE' && row.Group === 'asset');

// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
const keyboard = accounts.map(acc => [
  {
    text: `${acc.Icon} ${acc.Name}`,
    callback_data: JSON.stringify({
      a: ctx.amount,
      t: 'exp',
      src: acc.ID,
      umid: ctx.userMessageId
    })
  }
]);

// –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å"
keyboard.push([{
  text: '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç',
  callback_data: JSON.stringify({ action: 'add_account', umid: ctx.userMessageId })
}]);

// –ù–∞–∑–∞–¥
keyboard.push([{
  text: '‚óÄÔ∏è –ù–∞–∑–∞–¥',
  callback_data: JSON.stringify({ a: ctx.amount, umid: ctx.userMessageId })
}]);

return {
  json: {
    chat_id: ctx.chatId,
    message_id: ctx.messageId,
    text: `üìâ –†–∞—Å—Ö–æ–¥ ${ctx.amount} ‚Ç∏\n\n–û—Ç–∫—É–¥–∞ —Å–ø–∏—Å–∞—Ç—å?`,
    reply_markup: JSON.stringify({ inline_keyboard: keyboard })
  }
};
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü—ã Ref_Accounts –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:
ID	Name	Group	Icon	Active
kaspi	Kaspi Gold	asset	üí≥	TRUE
cash	–ù–∞–ª–∏—á–Ω—ã–µ	asset	üíµ	TRUE
halyk	Halyk Bank	asset	üåê	TRUE
–°–æ–∑–¥–∞–π —ç—Ç–æ—Ç –ª–∏—Å—Ç –∏–ª–∏ –ø–æ–∫–∞–∂–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å! üìä



